generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Camera {
  id         Int      @id @default(autoincrement())
  userId     String   // Cognito user sub
  camera     String   // Camera name/identifier
  location   String?  // Physical location
  ip         String?  // IP address or RTSP URL (e.g., "192.168.1.201:554")
  username   String?  // RTSP/camera auth username
  password   String?  // RTSP/camera auth password (should encrypt in production)
  detection  String   @default("LOCAL")
  streamType String   @default("WEBRTC") // "WEBRTC", "HLS", or "RTSP"
  streamName String?  // Stream path (e.g., "/h264Preview_01_main" for RTSP)
  hlsUrl     String?  // Direct HLS URL if not using RTSP
  webrtcBase String?  // WebRTC base URL
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  
  detections Detection[]

  @@unique([userId, camera])
  @@index([userId])
}

model Detection {
  id        Int      @id @default(autoincrement())
  cameraId  Int
  ts        DateTime @default(now())
  isFire    Boolean
  score     Float?
  boxesJson String?

  camera Camera @relation(fields: [cameraId], references: [id], onDelete: Cascade)

  @@index([cameraId, ts])
  @@index([ts])
}